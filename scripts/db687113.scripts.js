"use strict";angular.module("blogApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/canvas",{templateUrl:"views/canvas.html",controller:"CanvasCtrl"}).otherwise({redirectTo:"/canvas"})}]),angular.module("blogApp").controller("CanvasCtrl",["$scope",function(){}]),angular.module("blogApp").directive("page",["Registry",function(a){return{template:'<article class="page"><div class="page_container"></div><div class="content" ng-transclude></div></article>',restrict:"E",replace:!0,transclude:!0,link:function(b,c,d){var e=c.find(".page_container"),f=d.width||c.parent().width(),g=d.height||c.parent().height(),h=d.bleed||10,i=d.wobble||1,j=d.strokeWidth||3,k=d.strokeColor||"#000",l=new Raphael(e[0],f,g),m=l.drawnRect(h+j,h+j,f-2*(h+j),g-2*(h+j),i);m.attr({stroke:k,"stroke-width":j});var n=Raphael.createUUID();l.id=n,c.attr("id","page_"+n).data({id:n,width:f,height:g,bleed:h,wobble:i,strokeWidth:j,strokeColor:k}),console.log(c.data()),a.addPage({id:n,page:l})}}}]),angular.module("blogApp").directive("pageRow",["$timeout","Registry",function(a,b){return{template:'<section class="row" ng-transclude></section>',restrict:"E",replace:!0,transclude:!0,link:function(c,d,e){a(function(){var a,c=d.parents("article.page").first(),f=c.data("id"),g=b.getPage(f),h=c.find("section.row"),i=d.prevAll("section.row"),j=e.width||c.data("width"),k=e.height||c.data("height"),l=e.bleed||c.data("bleed");angular.isUndefined(e.strokeWidth)&&(a=0),angular.isUndefined(e.strokeWidth)&&angular.isString(e.strokeColor)&&(a=1),angular.isString(e.strokeWidth)&&""!==e.strokeWidth&&(a=parseInt(e.strokeWidth),isNaN(a)&&(a=1)),angular.isString(e.strokeWidth)&&""===e.strokeWidth&&(a=c.data("strokeWidth"));var m,n=e.strokeColor||c.data("strokeColor"),o=l+a,p=j-2*o,q=(k-2*o)/h.size(),r=o,s=i.size()*q+o;m=angular.isNumber(a)?e.wobble||c.data("wobble"):1;var t=g.drawnRect(r,s,p,q,m);angular.isNumber(a)&&t.attr({stroke:n,"stroke-width":a});var u=Raphael.createUUID();t.id=u,d.attr("id","row_"+u).data({id:u,width:p,height:q,bleed:l,strokeWidth:a,strokeColor:n}),b.addRow({id:u,row:t})},10)}}}]),angular.module("blogApp").directive("panel",["$timeout","Registry",function(a,b){return{template:'<div class="panel"></div>',restrict:"E",replace:!0,link:function(c,d,e){a(function(){var a,c=d.parents("article.page").first(),f=c.data("height"),g=c.data("id"),h=b.getPage(g),i=d.parent(".row"),j=i.data("id"),k=(b.getRow(j),d.prevAll(".panel")),l=k.size(),m=i.find(".panel"),n=m.size(),o=i.prevAll(".row"),p=o.size(),q=c.find(".row"),r=q.size(),s=i.data("width"),t=(i.data("height"),e.bleed||i.data("bleed"));angular.isUndefined(e.strokeWidth)&&(a=1),angular.isUndefined(e.strokeWidth)&&angular.isString(e.strokeColor)&&(a=1),angular.isString(e.strokeWidth)&&""!==e.strokeWidth&&(a=parseInt(e.strokeWidth),isNaN(a)&&(a=1)),angular.isString(e.strokeWidth)&&""===e.strokeWidth&&(a=c.data("strokeWidth"));var u=e.strokeColor||c.data("strokeColor");f-=2*t;var v,w=2*(t+a),x=(s-w*(n+1))/n,y=(f-w*(r+1))/r,z=w*(l+1.5)+l*x,A=w*(p+1.5)+p*y;v=angular.isNumber(a)?e.wobble||c.data("wobble"):1;var B=h.drawnRect(z,A,x,y,v);console.log(a),angular.isNumber(a)&&B.attr({stroke:u,"stroke-width":a})},20)}}}]),angular.module("blogApp").service("Registry",function(){var a=this;return a.store={pages:[],rows:[]},a.addPage=function(b){if(!angular.isObject(b)||!angular.isString(b.id)||!angular.isObject(b.page))throw new Error("A page must be an object with a numeric id, and a reference to a Raphael paper");a.store.pages.push(b)},a.getPage=function(b){if(!angular.isString(b))throw new Error("The id must be valid");var c=_.find(a.store.pages,{id:b});return c?c.page:null},a.addRow=function(b){if(!angular.isObject(b)||!angular.isString(b.id)||!angular.isObject(b.row))throw new Error("A row must be an object with a numeric id, and a reference to a Raphael object");a.store.rows.push(b)},a.getRow=function(b){if(!angular.isString(b))throw new Error("The id must be valid");var c=_.find(a.store.rows,{id:b});return c?c.row:null},a});